---
title: struts和ajax结合
categories: Ajax
---
# 项目想法
> 这里接着上回用servlet和ajax结合，换成用`struts2和hibernate`框架生成。

# 项目过程
> 这里介绍点我用框架所遇到的问题

## 导入包的问题
> 除了struts基本包，hibernate必须包之外，还需加以下包
![](J2EE-sh_Ajax/1.png)
> 这里列出我所用的所有包
![](J2EE-sh_Ajax/2.png)

## 相对绝对路径问题解决
``` xml
<!--采用struts标签来替代-->
<s:url action='weibo_showImg'>
	<s:param name='id' value='#weibo.id'></s:param>
</s:url>
```
## struts配置问题
``` xml
<package name="weibo" extends="json-default" namespace="/">
        <action name="weibo_*" class="hhh.controller.WeiboAction" method="{1}">
            <result name="toIndex">/index.jsp</result>
            <result name="publish">/WEB-INF/jsp/publish.jsp</result>
            <result name="toList">/WEB-INF/jsp/list.jsp</result>
            <result name="success" type="json">
                <!--必须加这一句-->
            	<param name="root">postData</param> 
            </result>
            <allowed-methods>success,publishUI,listAirticle,publish,showImg</allowed-methods>
        </action>
    </package>
```
> 博主一开始没有加这一句`<param name="root">postData</param> `，导致各种找，终于不负辛苦，找到了，这里贴出`action`中的代码：
``` java
public String listAirticle(){
		if("post".equals(way)){
			currentPage += postTime;
			Page page = service.listAirticle(currentPage);
			postData = JSONArray.fromObject(page.getRecords()).toString();
			setPostData(postData);
			System.out.println(postData);//打印转换成json的数据
			return SUCCESS;
		}else{
			Page page = service.listAirticle(currentPage);
			ActionContext.getContext().put("weibos", page.getRecords());
			return "toList";
		}
```

# 调试所报的异常
```
commons-beanutils-1.8.0.jar不加这个包 
java.lang.NoClassDefFoundError: org/apache/commons/beanutils/DynaBean 
commons-collections.jar 不加这个包 
java.lang.NoClassDefFoundError: org/apache/commons/collections/map/ListOrderedMap
commons-lang-2.4.jar不加这个包 
java.lang.NoClassDefFoundError: org/apache/commons/lang/exception/NestableRuntimeException
commons-logging-1.1.1.jar不加这个包 
java.lang.NoClassDefFoundError: org/apache/commons/logging/LogFactory 
ezmorph-1.0.4.jar不加这个包 
java.lang.NoClassDefFoundError: net/sf/ezmorph/Morpher 
json-lib-2.3-jdk15.jar不加这个包 
java.lang.NoClassDefFoundError: net/sf/json/JSONObject 
```
> 更详细请参考原文[java转换json需要导入的jar包，org/apache/commons/lang/exception/NestableRuntimeException](http://blog.csdn.net/zenson_g/article/details/8491436)

## hibernate分页
```
```