---
title: 爬虫-爬取学校官网
categories: python-crawler
---

# 前言
> 之前断断续续的学习爬虫，结果忘得差不多了，现在重新开始认真学，公众号也要认真弄了，之前做了就一直没管  哈哈  就图个装逼！！

# 结构分析
![](爬虫-爬取学校官网/1.png)
> 正常的登录界面，可以写出以下代码:

## 初始化
``` py
# 传入对应用户名(studentnumber),密码(password),学校官网(schoolURL)
def __init__(self,studentnumber,password,schoolURL):
        self.studentnumber = studentnumber
        self.password = password
        self.schoolURL = schoolURL
        resp = requests.get(schoolURL)
        self.sl = etree.HTML(resp.content)
```
> 接下来就是验证码了，由于并没有找到好的库来识别验证码，就采用人工输入好了，就像超级课程表那样

## 验证码
``` py
#拿到图片
    def getCheckCode(self):
        imgURL = self.schoolURL+'/CheckCode.aspx'
        imgResp = requests.get(imgURL, stream=True)
        image = imgResp.content
        try:
            with open('code.jpg','wb') as f:
                f.write(image)
        except IOError,e:
            print("IO Error:%s" % e)
        finally:
            f.close()
```
> 拿到图片，并下载到本地

## 数据准备
![](爬虫-爬取学校官网/2.png)
> 由图可知所需发送的数据:

``` py
def getData(self,checkCode):
        VIEWSTATE = self.sl.xpath('//input[@name="__VIEWSTATE"]/@value')[0]
        VIEWSTATEGENERATOR = self.sl.xpath('//input[@name="__VIEWSTATEGENERATOR"]/@value')[0]
        data = {
            '__VIEWSTATE': VIEWSTATE,
            '__VIEWSTATEGENERATOR': VIEWSTATEGENERATOR,
            'txtUserName': self.studentnumber,
            'Textbox1': '',
            'Textbox2': self.password,
            'txtSecretCode': checkCode,
            'RadioButtonList1':u'学生'.encode('gb2312'),
            'Button1':'',
            'lbLanguage':'',
            'hidPdrs':'',
            'hidsc':''
            }
        return data
```

## 接下来