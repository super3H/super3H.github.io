---
title: s2sh-大学资源共享网项目
categories: s2sh
---

# 所遇问题
## 数据库问题
> 突然发现当数据库中没有数据，直接级联添加`学校-学院-课程`，竟然会报如下错:

``` sql
ERROR SqlExceptionHelper Cannot add or update a child row: a foreign key constraint fails (`s2shtest01`.`academy`, CONSTRAINT `FKiuc88a6pjg69r9krnm57slii4` FOREIGN KEY (`aid`) REFERENCES `school` (`sid`))
```
> 刚开始以为是`hibernate`没有添加`cascade`的缘故，集体原因不详，猜测为主从表不一致的问题.

## json解决hibernate中级联对象延迟加载问题
- 简介
> 相信大部分用过Ext的GridPanel显示数据的朋友都遇到过外键数据的问题，首先是转换格式，将数据库里查出来的List集合要转换为JSON格式，如果只是用

``` java
JSONObject json = new JSONObject();    
JSONArray dataArray = JSONArray.fromObject(list);
```
- 原因:
> 如果list中的数据都是普通数据类型的那能正常转换，但很少这种情况，<font color='#FE3E49'>大部分的数据都存在外键的数据，比如有个News类，他可能会有个发布人User的外键，那么用以上的方法转换是不行，将会出现死循环（我去了解到JSON它是这么一种机制，将数据拆分，一致拆分到全都是基本数据类型位置，比如，一个list存放着多个News数据，它是首先将list拆分成多个News，然后将News的多个属性都拆分出来，里面有个User对象，又得再拆分！问题就出现在这了，User里面又有一个News的集合，News里面又有User，因此导致死循环了）；</font>

- 解决方案
> json解决hibernate中级联对象延迟加载问题`net.sf.json.JSONException: org.... `
在hibernate中将pojo转化为json数据格式时，抛出：<font color=''net.sf.json.JSONException: org.hibernate.LazyInitializationException，通过网上的资料，解决办法如下(未列出所需库文件)：