---
title: s2sh-大学资源共享网项目
categories: s2sh
---

# 所遇问题
## 数据库错误
> 报如下错:

``` java
Cannot add or update a child row: a foreign key constraint fails (`s2shtest01`.`problem`, CONSTRAINT `FK5lcmhm21chjl0wog8par6isxn` FOREIGN KEY (`pid`) REFERENCES `course` (`cid`))
```
> 后来发现。。`hibernate`配置文件竟然写错了，如此低级的错误

``` xml
<class name="School">
        <id name="sid">
        	<generator class="native"></generator>
        </id>
        <property name="sName"></property>
        <set name="academys">
        	<key>
        	<!--<column name="aid"></column>-->
        		<column name="sid"></column>
        	</key>
        	<one-to-many class="Academy"/>
        </set>
    </class>
```
> 错误如上,`<key>`里为academys的外键。。结果把它的外键和自己的主键绑定到一起了。

## json解决hibernate中级联对象延迟加载问题
- 简介
> 相信大部分用过Ext的GridPanel显示数据的朋友都遇到过外键数据的问题，首先是转换格式，将数据库里查出来的List集合要转换为JSON格式，如果只是用

``` java
JSONObject json = new JSONObject();    
JSONArray dataArray = JSONArray.fromObject(list);
```
- 原因:
> 如果list中的数据都是普通数据类型的那能正常转换，但很少这种情况，<font color='#FE3E49'>大部分的数据都存在外键的数据，比如有个News类，他可能会有个发布人User的外键，那么用以上的方法转换是不行，将会出现死循环（我去了解到JSON它是这么一种机制，将数据拆分，一致拆分到全都是基本数据类型位置，比如，一个list存放着多个News数据，它是首先将list拆分成多个News，然后将News的多个属性都拆分出来，里面有个User对象，又得再拆分！问题就出现在这了，User里面又有一个News的集合，News里面又有User，因此导致死循环了）；</font>

- 解决方案
> json解决hibernate中级联对象延迟加载问题`net.sf.json.JSONException: org.... `
在hibernate中将pojo转化为json数据格式时，抛出：<font color='#48B456'>**net.sf.json.JSONException: org.hibernate.LazyInitializationException，**</font>通过网上的资料，解决办法如下(未列出所需库文件)：

- 第一种:
``` java
JsonConfig jsonConfig = new JsonConfig(); 
jsonConfig .setJsonPropertyFilter(new PropertyFilter(){

public boolean apply(Object source, String name, Object value){
    if (name.equals("property1") || name.equals("property2")){// 这里填写需要过滤的属性名
         return true;
    }
    return false;
    }
});

JSONObject jsonModel= JSONArray.fromObject(yourObject, jsonConfig );
```
- 第二种:
``` java
JsonConfig jsonConfig = new JsonConfig();

jsonConfig .setExcludes( new String[]{ "property1" , "property2" } ) ;

JSONObject jsonModel= JSONArray.fromObject(yourObject, jsonConfig );
}
```
> 详情请参考[json解决hibernate中级联对象延迟加载问题net.sf.json.JSONException: ](http://blog.csdn.net/evelyn2010816/article/details/6321758)

## c:forEach问题
> 报错如下:

``` java
According to TLD or attribute directive in tag file, attribute value does not accept any exception
```
- 方法如下
    - 一种是将`http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd`改成`http://java.sun.com/xml/ns/javaee/web-app_2_3.xsd`；
    - 另一种是将JSP页面中的<font color='red'>**<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core"%>改成<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core_rt"%>。**</font>在jstl-1.0.2.jar下的META-INF中有一个c.tld还有一个c-rt.tld,后一个好像是jstl核心库备用板的标签描述文件。
> 参考如下:[According to TLD or attribute directive in tag file](http://blog.sina.com.cn/s/blog_6b39e1d10100mwp4.html)
