---
title: Spring AOP+AspectJ
categories: spring
---

# 简介
* 常见AspectJ的注解：
    * `@Before:`方法执行前运行
    * `@After:`运行在方法返回结果后
    * `@AfterReturning:`运行在方法返回一个结果后，在拦截器返回结果
    * `@AfterThrowing:`运行方法在抛出异常后
    * `@Around:`围绕方法执行运行，结合以上这三个通知
> `注意:`Spring AOP 中没有 AspectJ 支持

# 目录结构
![](Spring AOP+AspectJ/1.png)

# Spring Beans
> 普通 bean 中有几个方法，后来通过 AspectJ 注解拦截

``` java
package com.yiibai.customer.bo;

public interface CustomerBo {

	void addCustomer();
	
	String addCustomerReturnValue();
	
	void addCustomerThrowException() throws Exception;
	
	void addCustomerAround(String name);
}
```
``` java
package com.yiibai.customer.bo.impl;

import com.yiibai.customer.bo.CustomerBo;

public class CustomerBoImpl implements CustomerBo {

	public void addCustomer(){
		System.out.println("addCustomer() is running ");
	}
	
	public String addCustomerReturnValue(){
		System.out.println("addCustomerReturnValue() is running ");
		return "abc";
	}
	
	public void addCustomerThrowException() throws Exception {
		System.out.println("addCustomerThrowException() is running ");
		throw new Exception("Generic Error");
	}
	
	public void addCustomerAround(String name){
		System.out.println("addCustomerAround() is running, args : " + name);
	}
}
```

# 启用AspectJ
> 在 Spring 配置文件，把`“<aop:aspectj-autoproxy />”`，并定义Aspect(拦截)和普通的bean。
File : applicationContext.xml

``` xml
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:aop="http://www.springframework.org/schema/aop"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-3.0.xsd 
	http://www.springframework.org/schema/aop 
	http://www.springframework.org/schema/aop/spring-aop-3.0.xsd ">

	<aop:aspectj-autoproxy />

	<bean id="customerBo" class="com.yiibai.customer.bo.impl.CustomerBoImpl" />

	<!-- Aspect -->
	<bean id="logAspect" class="com.yiibai.aspect.LoggingAspect" />

</beans>
```

# AspectJ @Before
> 在下面例子中，logBefore()方法将在 customerBo接口的 addCustomer()方法的执行之前被执行。
AspectJ的“切入点”是用来声明哪种方法将被拦截，应该参考Spring AOP切入点指南，支持切入点表达式的完整列表。
File : LoggingAspect.java