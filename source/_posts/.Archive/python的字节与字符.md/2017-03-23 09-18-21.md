---
title: python的字节与字符
categories: Python
---

# str与unicode
> Python2 把字符串分为 unicode 和 str 两种类型。本质上 str 是一串二进制字节序列，下面的示例代码可以看出 str 类型的 "禅" 打印出来是十六进制的 \xec\xf8 ，对应的二进制字节序列就是 '11101100 11111000'。

``` py
>>> s = '禅'
>>> s
'\xec\xf8'
>>> type(s)
<type 'str'>
```
> 而 unicode 类型的 u"禅" 对应的 unicode 符号是 u'\u7985'

``` py
>>> u = u"禅"
>>> u
u'\u7985'
>>> type(u)
<type 'unicode'>
```
> 我们要把 unicode 符号保存到文件或者传输到网络就需要经过编码处理转换成 str 类型，于是 python 提供了 encode 方法，从 unicode 转换到 str，反之亦然。

# encode与decode
- encode
``` py
>>> u = u"禅"
>>> u
u'\u7985'
>>> u.encode("utf-8")
'\xe7\xa6\x85'
```
- decode
``` py
>>> s = "禅"
>>> s.decode("utf-8")
u'\u7985'
>>>
```
> unicode 到 str 的转换要用 encode 方法，反过来就是用 decode 方法

# UnicodeEncodeError
> UnicodeEncodeError 发生在 unicode 字符串转换成 str 字节序列的时候，来看一个例子，把一串 unicode 字符串保存到文件

``` py
# -*- coding:utf-8 -*-
def main():
    name = u'Python之禅'
    f = open("output.txt", "w")
    f.write(name)

# 错误如下
UnicodeEncodeError: 'ascii' codec can't encode characters in position 6-7: ordinal not in range(128)
```
> `原因:`<font color='#E7C800'>因为调用 write 方法时，Python 会先判断字符串是什么类型，如果是 str，就直接写入文件，不需要编码，因为 str 类型的字符串本身就是一串二进制的字节序列了。</font>
> <font color='#008AE2'>如果字符串是 unicode 类型，那么它会先调用 encode 方法把 unicode 字符串转换成二进制形式的 str 类型，才保存到文件，而 encode 方法会使用 python 默认的 ascii 码来编码</font>
> 相当于：

``` py
>>> u"Python之禅".encode("ascii")
```
> 但是，**我们知道 ASCII 字符集中只包含了128个拉丁字母，不包括中文字符**，因此 出现了 'ascii' codec can't encode characters 的错误。要正确地使用 encode ，就必须指定一个包含了中文字符的字符集，比如：UTF-8、GBK。

``` py
>>> u"Python之禅".encode("utf-8")
'Python\xe4\xb9\x8b\xe7\xa6\x85'

>>> u"Python之禅".encode("gbk")
'Python\xd6\xae\xec\xf8'
```

> 所以要把 unicode 字符串正确地写入文件，就应该预先把字符串进行 UTF-8 或 GBK 编码转换。