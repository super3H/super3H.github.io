---
title: hibernate中openSession()跟getCurrentSession()的区别
---

# openSession()与getCurrentSession()
1. 采用`getCurrentSession()`创建的Session会绑定到当前的线程中去、而采用`OpenSession()`则不会。**查询也需要开事务，否则会报错**
2. 采用`getCurrentSession()`创建的Session在commit或rollback后会自动关闭，采用`OpenSession()`必须手动关闭。
3. 采用`getCurrentSession()`需要在`Hibernate.cfg.xml`配置文件中加入如下配置：

> 如果是本地事物，及JDBC一个数据库：`<propety name=”Hibernate.current_session_context_class”>thread</propety>`
> 如果是全局事物，及jta事物、多个数据库资源或事物资源：`<propety name=”Hibernate.current_session_context_class”>jta</propety>`
> 使用spring的getHiberanteTemplate 就不需要考虑事务管理和session关闭的问题

# 补充
> `openSession`创建session时autoCloseSessionEnabled参数为false，即在事物结束后不会自动关闭session，需要手动关闭，如果不关闭将导致session关联的数据库连接无法释放，最后资源耗尽而使程序当掉。              

> `getCurrentSession`创建session时autoCloseSessionEnabled，flushBeforeCompletionEnabled都为true，并且session会同sessionFactory组成一个map以sessionFactory为主键绑定到当前线程。

> `getCurrentSession()`:从上下文（配置文件current_session_context_class: thread 使用Connection自动管理；jta(java transaction api) 由Application Server提供的分布式事务管理，Tomcat本身不具备此能力，JBoss、WebLogic具备）找，如果有，则用旧的，否则创建新的，**事务提交自动Close；**

# 原文链接
[hibernate中openSession()跟getCurrentSession()方法之间的区别 ](http://www.cnblogs.com/Ant-soldier/p/5051478.html)
