---
title: Hibernate浅学
categories: J2EE-Hibernate
---

# 简介
> Hibernate是一种对JDBC做了轻量级封装的对象---关系映射工具，所谓轻量级封装，是指Hibernate并没有完全封装JDBC，Java应用即可以通过Hibernate API访问数据库，还可以绕过Hibernate API，直接通过JDBC API来访问数据库。

- `Hibernate`官网下载地址[Hibernate官网](http://www.hibernate.org)。现在最新的是： hibernate-release-5.2.5.Final
 > 解压后的目录结构：
 > `Documentation`: 该文件夹下是开发帮助文档
 > `Lib`: 该文件夹是开发使用的库。以下包为必须的：
 - `required`目录是开发时必须导入的`JAR`文件；
 - `optional\c3p0`目录为开源的`JDBC`连接池(与其相对应的为的`dbcp`,区别：`dbcp`没有自动回收空闲连接的功能||`c3p0`有自动回收空闲连接功能，一般都用c3p0)
 -  `mysql-connector-java`JDBC驱动包
  > `Project`: 该文件夹是项目源码文件
- 持久化JAVA类必须遵循的原则
  > A、为类的持久化字段声明访问方法（`get/set`），`Hibernate`对`JavaBeans`风格的属性实行持久化。
 > B、实现一个默认的构造方法，这样的话`Hibernate`就可以使用`Constructor.newInstance()`方法来实例化对象。
 > C、如果是集合类型的属性，它的类型必须定义为集合的接口，例如：`List`、`Set`
 > D、提供一个标识属性（`Identifier property` )，如果没有该属性，一些功能不起作用，比如：级联更新，`session.saveOrUpdate()`。
 
# 开发步骤
## 编写实体类UserInfor.java
- 实体类中的属性名有二个以上（含两个）的小写字母开头！！！！
``` java
import java.util.Date;
public class UserInfor {
   
    private int userId;
    private String userName;
    private int userAge;
    public UserInfor() {
        // 一定要有一个无参的构造方法，因为Hibernate都是根据他生成对象的
    }
    public UserInfor(int userid)
    {// 最好要有一个含主键的构造方法，因为在Hibernate中便于查询
        this.userId = userid;
    }
    //....下面都是get***（）set***()封装属性
    }
```
## 创建实体类的映射文件***.hbm.xml（与实体类同包，并且名字可以自定义，这里是：userInfor.hbm.xml）
 > 技巧: 可以在上面解压后的`Project`文件夹中搜索`*.hbm.xml`，找到示例文在加以修改即可！！！

``` xml
<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="com.entity">

    <class name="UserInfor" table="Wuser" >
        <id name="userId" >
            <generator class="native"/>
        </id>
        <property name="userName"/>
        <property name="userAge"/>
        <property name="userBirthday"/>
    </class>
</hibernate-mapping>
```
> 具体hibernate详情请看[详解](http://chen25362936.blog.163.com/blog/static/2565547420101113112752675/)

- 根元素：`<hibernate-mapping>`
> 每一个`hbm.xml`文件都有唯一的一个根元素，包含一些可选的属性 `package`：指定一个包前缀，即该`xml`文件的位置
- `<class>`定义类
> 根元素的子元素，用以定义一个持久化类与数据表的映射关系,如下是该元素包含的一些可选的属性--> `name`：持久化类(或者接口)的`Java`全限定名,如果这个属性不存在,则Hibernate将假定这是一个非`POJO`的实体映射；`table`：对应数据库表名
- `<id>`定义主键
> `Hibernate`使用`OID`(对象标识符)来标识对象的唯一性，`OID`是关系数据库中主键在`Java`对象模型中的等价物,在运行时,`Hibernate`根据`OID`来维持`Java`对象和数据库表中记录的对应关系
 - `name`：持久化类的标识属性的名字
 - `column`：数据库表的主键这段的名字
 - `<generator>`设置主键生成方式
> 该元素的作用是指定主键的生成器，通过一个class属性指定生成器对应的类。(通常与<id>元素结合使用)，--native是Hibernate主键生成器的实现算法之一，由Hibernate根据底层数据库自行判断采用identity、hilo、sequence其中一种作为主键生成方式。
- `<property>`定义属性
> 用于持久化类的属性与数据库表字段之间的映射,包含如下属性：
 - name：持久化类的属性名，以小写字母开头
 - column：数据库表的字段名
## 编写Hibernate的配置文件hibernate.cfg.xml（这里的名字是固定的）
Hibernate配置的两种方法：
- 属性文件：hibernate.properties
- 调用代码：Configuration cfg=new Configuration();
- XML文件：hibernate.cfg.xml
- 调用代码： Configuration cfg=new Configuration().configure();
``` xml
<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE hibernate-configuration PUBLIC
        "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd">
<hibernate-configuration>
	<!-- 
		一个session-factory只能连接一个数据库
	-->
	<session-factory>
		<!-- 
			数据库的用户名
		-->
		<property name="connection.username">root</property>
		<!-- 
			密码
		-->
		<property name="connection.password">root</property>
		<!-- 
			url
		-->
		<property name="connection.url">
			jdbc:mysql://localhost:3306/hibernateday02
		</property>
		<!-- 
			作用：根据持久化类和映射文件生成表
			validate
			create-drop
			create
			update
		-->
		<property name="hbm2ddl.auto">update</property>
		<!-- 
			显示hibernate内部生成的sql语句
		-->
		<property name="show_sql">true</property>
		<mapping resource="hhh/domain/Person.hbm.xml" />
		<mapping resource="hhh/domain1/Clazz.hbm.xml" />
		<mapping resource="hhh/domain1/student.xml" />
		<mapping resource="hhh/Person.hbm.xml" />

	</session-factory>
</hibernate-configuration>
```
# 测试类操作
``` java
	@Test
	public void test() {
    	// 读取Hibernate的配置文件  hibernamte.cfg.xml文件
		Configuration configuration = new Configuration().configure();
		// 创建会话工厂
		SessionFactory sessionFactory = configuration.buildSessionFactory();
		// 创建数据操作会话
		Session session = sessionFactory.openSession();
		// 开启事务并创建事物
		Transaction transaction = session.beginTransaction();
        // 创建对象
		Person person = new Person();
		person.setName("hhh");
		session.save(person);
        // 事务提交
		transaction.commit();
        // 关闭会话
		session.close();

	}
```
# configure解析
![](J2EE-Hibernate/configure.png)

# hibernate运行过程

![](J2EE-Hibernate/process.png)

# hibernate优缺点

