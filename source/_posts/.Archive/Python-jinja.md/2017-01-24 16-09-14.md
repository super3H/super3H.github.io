---
title: Python-jinja 学习
---

# 注册过滤器
> 如果你要在 Jinja2 中注册你自己的过滤器，你有两种方法。你可以把它们手动添加到应用的 jinja_env 或者使用 template_filter() 装饰器。
下面两个例子作用相同，都是反转一个对象:
``` python
#第一种方法
@app.template_filter('reverse')
def reverse_filter(s):
    return s[::-1]

#第二种方法
def reverse_filter(s):
    return s[::-1]
app.jinja_env.filters['reverse'] = reverse_filter
```
> 在使用装饰器的情况下，如果你想以函数名作为过滤器名，参数是可选的。注册之后， 你可以在模板中像使用 Jinja2 内置过滤器一样使用你的过滤器，请参考下面例子：
``` python
{% for x in [1,2,3] | reverse %}
    {{x}}
{% endfor %}
#输出
3 2 1
```
# 上下文处理器
> Flask 上下文处理器自动向模板的上下文中插入新变量。上下文处理器在模板渲染之前运行，并且可以在模板上下文中插入新值。上下文处理器是一个返回字典的函数，这个字典的键值最终将传入应用中所有模板的上下文:
``` python
@app.context_processor
def inject_user():
    return dict(user=g.user)
```
> 上面的上下文处理器使得模板可以使用一个名为 user ，值为 g.user 的变量。 不过这个例子不是很有意思，因为 g 在模板中本来就是可用的，但它解释了上下文处理器是如何工作的。
变量不仅限于值，上下文处理器也可以使某个函数在模板中可用（由于 Python 允许传递函数）:
``` python
@app.context_processor
def utility_processor():
    def format_price(amount, currency=u'€'):
        return u'{0:.2f}{1}.format(amount, currency)
    return dict(format_price=format_price)
```
> 上面的上下文处理器使得 format_price 函数在所有模板中可用:
``` python
{{ format_price(0.333333) }}
#输出
0.33
```